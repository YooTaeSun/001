

SELECT 
T1.CODE,
T1.CODE_NAME,
T1.AMT,
T1.COL_FIELD,
T1.COL_LOC_INDEX,
REPLACE(SUBSTR(COL_VAL_0, 1, COL_LOC_INDEX) ||  'IT' || SUBSTR(COL_VAL_0, COL_LOC_INDEX+1), '0IT', T1.AMT) AS COL_VAL,
T1.COL_VAL_0
 FROM (
SELECT
	CODE,
	COL_VAL_0,
	CODE_NAME, 
	AMT,
	COL_FIELD,
	(LENGTH(SUBSTR(REPLACE(COL_FIELD, CODE,AMT), 1,INSTR(COL_FIELD, CODE, 1)))-length(replace(SUBSTR(REPLACE(COL_FIELD, CODE,AMT), 1,INSTR(COL_FIELD, CODE, 1)),',',''))+ 1) * 2-1 AS COL_LOC_INDEX
FROM (
	SELECT
		(SELECT LISTAGG(CODE, ',') within group (order by CODE) FROM (SELECT DISTINCT CODE AS CODE  FROM CODE_DATA)) AS COL_FIELD,
		(SELECT LISTAGG(0, ',') within group (order by 0) FROM (SELECT DISTINCT CODE AS CODE  FROM CODE_DATA)) AS COL_VAL_0,
		CODE,
		CODE_NAME,
		AMT
	FROM CODE_DATA
	GROUP BY CODE,CODE_NAME,AMT
) T1
ORDER BY CODE
) T1
